(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{117:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return f}));var n=r(0),a=r.n(n);function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},c=Object.keys(e);for(n=0;n<c.length;n++)r=c[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)r=c[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var o=a.a.createContext({}),u=function(e){var t=a.a.useContext(o),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},p=function(e){var t=u(e.components);return a.a.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},b=a.a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,c=e.originalType,s=e.parentName,o=i(e,["components","mdxType","originalType","parentName"]),p=u(r),b=n,f=p["".concat(s,".").concat(b)]||p[b]||d[b]||c;return r?a.a.createElement(f,l(l({ref:t},o),{},{components:r})):a.a.createElement(f,l({ref:t},o))}));function f(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var c=r.length,s=new Array(c);s[0]=b;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:n,s[1]=l;for(var o=2;o<c;o++)s[o]=r[o];return a.a.createElement.apply(null,s)}return a.a.createElement.apply(null,r)}b.displayName="MDXCreateElement"},79:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return s})),r.d(t,"metadata",(function(){return l})),r.d(t,"toc",(function(){return i})),r.d(t,"default",(function(){return u}));var n=r(3),a=r(7),c=(r(0),r(117)),s={id:"swap-tx",sidebar_label:"Swap",title:"Swap Transaction Structure"},l={unversionedId:"tx-script-sudt/swap-tx",id:"tx-script-sudt/swap-tx",isDocsHomePage:!1,title:"Swap Transaction Structure",description:"A swap operation might be involved in 3 transactions:",source:"@site/docs/tx-script-sudt/swap-tx.md",slug:"/tx-script-sudt/swap-tx",permalink:"/gliaswap-docs/docs/tx-script-sudt/swap-tx",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/tx-script-sudt/swap-tx.md",version:"current",sidebar_label:"Swap",sidebar:"docs",previous:{title:"Cell Structure",permalink:"/gliaswap-docs/docs/tx-script-sudt/cell"},next:{title:"Pool transaction structure",permalink:"/gliaswap-docs/docs/tx-script-sudt/pool-tx"}},i=[{value:"1. Traders submit swap request",id:"1-traders-submit-swap-request",children:[]},{value:"2. Deal-miners match swap request with pool cells",id:"2-deal-miners-match-swap-request-with-pool-cells",children:[{value:"Swap request lock script - rule 1",id:"swap-request-lock-script---rule-1",children:[]},{value:"Info type script",id:"info-type-script",children:[]},{value:"Info lock script",id:"info-lock-script",children:[]}]},{value:"3. Traders can cancel their own swap request",id:"3-traders-can-cancel-their-own-swap-request",children:[{value:"Swap request lock script - rule 2",id:"swap-request-lock-script---rule-2",children:[]}]}],o={toc:i};function u(e){var t=e.components,r=Object(a.a)(e,["components"]);return Object(c.b)("wrapper",Object(n.a)({},o,r,{components:t,mdxType:"MDXLayout"}),Object(c.b)("p",null,"A swap operation might be involved in 3 transactions:"),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"Traders submit swap request"),Object(c.b)("li",{parentName:"ol"},"Aggregators match swap request with pool to help traders to complete swap"),Object(c.b)("li",{parentName:"ol"},"Traders cancel swap request")),Object(c.b)("h2",{id:"1-traders-submit-swap-request"},"1. Traders submit swap request"),Object(c.b)("pre",null,Object(c.b)("code",Object(n.a)({parentName:"pre"},{}),"\nany_free_ckb_cell    -------\x3e    swap_request_cell\n\n")),Object(c.b)("h2",{id:"2-deal-miners-match-swap-request-with-pool-cells"},"2. Deal-miners match swap request with pool cells"),Object(c.b)("p",null,"After traders submit the swap request, Aggregators will help traders to complete the swap. Motivated by the Tip fee claimed in the swap request cell (tip fee currently is 0), aggregators will continually retrieve the swap request cells and the pool cells on chain and then compete to match them off-chain and submit matching transactions. We open sourced a simple aggregators software for basic use. Information on how to deploy it can be found on ",Object(c.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/glias/glia-sudt-swap-matcher"}),"GitHub"),". This software is a starting point for you to develop your own solution. You can maximize earnings by identifying and implementing your optimization strategies."),Object(c.b)("p",null,"The matching transaction may looks like:"),Object(c.b)("pre",null,Object(c.b)("code",Object(n.a)({parentName:"pre"},{}),"info_in_cell                            info_out_cell\npool_x_in_cell                          pool_x_out_cell\npool_y_in_cell                          pool_y_out_cell\n                          -------\x3e\nmatcher_in_cell                         matcher_out_ckb_cell\n\n[swap_request_cell]                     [sudt_swapped_cell\n                                       + ckb_change_cell]\n\n[ add_liquidity_x_cell                  [sudt_lp_cell\n+ add_liquidity_y_cell                 + sudt_change_cell\n                                       + ckb_change_cell]\n\n[remove_liquidity_cell]                 [sudt_x_cell\n                                       + sudt_y_cell]\n\n")),Object(c.b)("p",null,"In this transaction, three types of script will be run to verify the tx:"),Object(c.b)("h3",{id:"swap-request-lock-script---rule-1"},"Swap request lock script - rule 1"),Object(c.b)("p",null,"Rule 1 - verifity if the actual pay amount and receive amount satisfy the request amount in swap request cell."),Object(c.b)("h3",{id:"info-type-script"},"Info type script"),Object(c.b)("p",null,"Rule 1 - ",Object(c.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/nervosnetwork/ckb/blob/master/script/src/type_id.rs"}),"TypeID rules")),Object(c.b)("p",null,"Rule 2 - If this is a matching transaction, the cell sequence in this tx should follow the rules above."),Object(c.b)("p",null,"Rule 3 - Intercept the swap request queue from inputs and outputs, and for each request cell\uff0cverifity if the actual pay amount and receive amount satisfy the request amount in swap request cell. And update the sudt_x_reserve and sudt_y_reserve for following verification."),Object(c.b)("h3",{id:"info-lock-script"},"Info lock script"),Object(c.b)("p",null,"Rules 1 - Verify if lock.args is consistent with info type"),Object(c.b)("h2",{id:"3-traders-can-cancel-their-own-swap-request"},"3. Traders can cancel their own swap request"),Object(c.b)("pre",null,Object(c.b)("code",Object(n.a)({parentName:"pre"},{}),"\nswap_request_cell   -------\x3e    sUDT normal_cell \n\n")),Object(c.b)("p",null,"This transaction leads to another rule of swap request lock script"),Object(c.b)("h3",{id:"swap-request-lock-script---rule-2"},"Swap request lock script - rule 2"),Object(c.b)("p",null,"Rule2 - If one of input cell in the transaction use user's lock specified in liquidity request cell args and the corresponding witness is not 0, unlock the request cell directly."))}u.isMDXComponent=!0}}]);