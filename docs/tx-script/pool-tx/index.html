<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/gliaswap-docs/blog/rss.xml" title="Gliaswap Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/gliaswap-docs/blog/atom.xml" title="Gliaswap Blog Atom Feed"><title data-react-helmet="true">Pool transaction structure | Gliaswap</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Pool transaction structure | Gliaswap"><meta data-react-helmet="true" name="description" content="In pool pageï¼Œwhen Liquidity Providersï¼ˆLPs) mananger their liquidity, 5 types of transaction may be involved:"><meta data-react-helmet="true" property="og:description" content="In pool pageï¼Œwhen Liquidity Providersï¼ˆLPs) mananger their liquidity, 5 types of transaction may be involved:"><meta data-react-helmet="true" property="og:url" content="https://zoe-zhouzhou.github.io/gliaswap-docs/docs/tx-script/pool-tx"><link data-react-helmet="true" rel="shortcut icon" href="/gliaswap-docs/img/logo.svg"><link data-react-helmet="true" rel="canonical" href="https://zoe-zhouzhou.github.io/gliaswap-docs/docs/tx-script/pool-tx"><link rel="stylesheet" href="/gliaswap-docs/styles.066e4677.css">
<link rel="preload" href="/gliaswap-docs/styles.e14deca6.js" as="script">
<link rel="preload" href="/gliaswap-docs/runtime~main.67eb29e5.js" as="script">
<link rel="preload" href="/gliaswap-docs/main.0343998c.js" as="script">
<link rel="preload" href="/gliaswap-docs/1.dba57845.js" as="script">
<link rel="preload" href="/gliaswap-docs/2.aeef72c1.js" as="script">
<link rel="preload" href="/gliaswap-docs/46.04a79037.js" as="script">
<link rel="preload" href="/gliaswap-docs/47.2bc9e338.js" as="script">
<link rel="preload" href="/gliaswap-docs/935f2afb.4513c572.js" as="script">
<link rel="preload" href="/gliaswap-docs/17896441.3c886368.js" as="script">
<link rel="preload" href="/gliaswap-docs/121de096.a822be93.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/gliaswap-docs/"><img src="/gliaswap-docs/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/gliaswap-docs/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Gliaswap</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/gliaswap-docs/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/gliaswap" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/gliaswap-docs/"><img src="/gliaswap-docs/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/gliaswap-docs/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Gliaswap</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/gliaswap-docs/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/gliaswap" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Start</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gliaswap-docs/docs/">Introduction</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Run Gliaswap</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gliaswap-docs/docs/run/run">Run Gliaswap</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Product</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gliaswap-docs/docs/product/overview">Gliaswap Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gliaswap-docs/docs/product/fee">Fee Structure</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Protocol</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Swap sUDT/CKB</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gliaswap-docs/docs/tx-script/cell">Cell Structure</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Transaction Structure</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gliaswap-docs/docs/tx-script/swap-tx">Swap</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/gliaswap-docs/docs/tx-script/pool-tx">Pool</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Script</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gliaswap-docs/docs/tx-script/info-type-script">Info Cell Type Script</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gliaswap-docs/docs/tx-script/info-lock-script">Info Cell Lock Script</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gliaswap-docs/docs/tx-script/swap-lock-script">Swap Request Cell Lock Script</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gliaswap-docs/docs/tx-script/liquidity-lock-script">Liquidity Request Cell Lock Script</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Swap sUDT/sUDT</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gliaswap-docs/docs/tx-script-sudt/cell">Cell Structure</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Transaction Structure</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gliaswap-docs/docs/tx-script-sudt/swap-tx">Swap</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gliaswap-docs/docs/tx-script-sudt/pool-tx">Pool</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Script</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gliaswap-docs/docs/tx-script-sudt/info-type-script">Info Cell Type Script</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gliaswap-docs/docs/tx-script-sudt/info-lock-script">Info Cell Lock Script</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gliaswap-docs/docs/tx-script-sudt/swap-lock-script">Swap Request Cell Lock Script</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gliaswap-docs/docs/tx-script-sudt/liquidity-lock-script">Liquidity Request Cell Lock Script</a></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gliaswap-docs/docs/ref/faq">FAQ</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Pool transaction structure</h1></header><div class="markdown"><p>In pool pageï¼Œwhen Liquidity Providersï¼ˆLPs) mananger their liquidity, 5 types of transaction may be involved:</p><ol><li>Anyone can creat a pool</li><li>Liquidity Providersï¼ˆLPs) submit add liquidity request</li><li>Liquidity Providersï¼ˆLPs) submit remove liquidity request</li><li>Aggregators match liquidity request with pool to help LP to manager their liquidity sucessfully</li><li>Liquidity Providersï¼ˆLPs) cancel liquidity request</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="1-creat-a-pool"></a>1. Creat a pool<a class="hash-link" href="#1-creat-a-pool" title="Direct link to heading">#</a></h2><p>Creat a pool in Gliaswap is permissionless. In the first version, Gliaswap only support to creat sudt/CKB pool. </p><p>Creat a pool actually is to creat two cell: </p><ul><li>info cell used to store pool info, including reserve balance, Liquidity token balance and other ID info to indentify the pool</li><li>pool cell used to store the real asset, including CKB and sudt</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Input</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Alice cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            250 + 186 + tx fee</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            NONE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            NONE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Alice lock</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Info cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            250</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ckb_reserve: 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            sudt_reserve: 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            lp_token_balance: 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            lp_token_type_hash</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            code: INFO_TYPE_CODE_HASH </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            args: type id </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            code: INFO_LOCK_CODE_HASH </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            args: hash(ckb | asset_sudt_type_hash) | info_type_hash </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Pool cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            186</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            sudt_amount: 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;sudt type&gt; </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;info cell lock&gt; </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In this transaction,  Only info type script will be run to verify the tx, which leads to the third validation rule of info type script</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="info-type-script---rule-4"></a>Info type script - rule 4<a class="hash-link" href="#info-type-script---rule-4" title="Direct link to heading">#</a></h3><p>Rule 4 - If this is a creating pool transaction, verify that the Pool cell is created at the same time as the Info cell, and that the data filled in info cell and pool cell are correct.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="2-lps-submit-add-liquidity-request"></a>2. LPs submit add liquidity request<a class="hash-link" href="#2-lps-submit-add-liquidity-request" title="Direct link to heading">#</a></h2><p>If a LP want to add liqidity to a pool, he/she needs to submit a add liquidity request firstly. For exampleï¼ŒAlice want to add M CKB and N sUDT_A to pool:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Input</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Alice normal cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;M + 142 + 142 + tx fee&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            tokenA amount: N</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;tokenA type&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;user&#x27;s lock&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Alice add liquidity request cell    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;M + 142 + 142&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            sudt_amount: N</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;tokenA type&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            code: LIQUIDITY_REQ_LOCK_CODE_HASH </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            args: user_lock_hash | version | sudtMin | ckbMin | info_type_hash_32 | 0 | 0 | // tip and tip fee are 0 in current version</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Notice that this transaction only validates regular SUDT rules constrained in sudt type script.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="3-lps-submit-remove-liquidity-request"></a>3. LPs submit remove liquidity request<a class="hash-link" href="#3-lps-submit-remove-liquidity-request" title="Direct link to heading">#</a></h2><p>If a LP want to remove liquidity from a pool, he/she needs to submit a remove liquidity request firstly. For exampleï¼ŒBob want to burn L Liquidity token and withdraw the </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Input</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Bob normal cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;235 + tx fee&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Liquidity token amount: N</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;Liquidity token type&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;user&#x27;s lock&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Bob remove liquidity request cell    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            235</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Liquidity token amount: L</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;Liquidity token type&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            code: LIQUIDITY_REQ_LOCK_CODE_HASH </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            args: user_lock_hash | version | sudtMin | ckbMin | info_type_hash_32 | 0 | 0 | // tip and tip fee are 0 in current version</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Notice that this transaction only validates regular SUDT rules constrained in sudt type script.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="4-aggregators-match-liquidity-request-with-pool"></a>4. Aggregators match liquidity request with pool<a class="hash-link" href="#4-aggregators-match-liquidity-request-with-pool" title="Direct link to heading">#</a></h2><p>Motivated by the Tip fee claimed in the liquidity request cell, aggregators will continually retrieve the liquidity request cellsï¼ˆincluding add liquidity request and remove liquidity requestï¼‰ and the pool cells and then compete to match them off-chain and submit matching transactions.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Input</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Info cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            250</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ckb_reserve: X</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            sudt_reserve: Y</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            lp_token_balance: Z</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            lp_token_type_hash</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            code: INFO_TYPE_CODE_HASH </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            args: type id </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            code: INFO_LOCK_CODE_HASH </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            args: hash(ckb | asset_sudt_type_hash) | info_type_hash </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Pool cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            186 + X</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            sudt_amount: Y</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;sudt type&gt; </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;info cell lock&gt;  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Deal-miner cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Bob remove liquidity request cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            235</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Liquidity token amount: l</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;Liquidity token type&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            code: LIQUIDITY_REQ_LOCK_CODE_HASH </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            args: user_lock_hash | version | sudtMin | ckbMin | info_type_hash_32 | 0 | 0 | // tip and tip fee are 0 in current version</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Alice add liquidity request cell    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;M + 142 + 142&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            sudt_amount: N</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;tokenA type&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            code: LIQUIDITY_REQ_LOCK_CODE_HASH </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            args: user_lock_hash | version | sudtMin | ckbMin | info_type_hash_32 | 0 | 0 | // tip and tip fee are 0 in current version</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Info cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            214</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ckb_reserve: X - l*X/L + M</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            sudt_reserve: Y - l*Y/L + N</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LP_token_balance: L - l + M*L/X</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            LP_token_type_hash20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            code: Info_TYPE_CODE_HASH </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            args: type id </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            code: INFO_LOCK_CODE_HASH </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            args: hash(ckb | asset_sudt_type_hash) | info_type_hash20 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Pool cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            162 + X - l*X/L + M</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            sudt_amount: Y - l*Y/L + N</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;sudt type&gt; </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;info cell lock&gt; </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Deal-miner cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Bob normal cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            184 + l*X/L</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            sudt_amount: l*Y/L</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;sudt type&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;Bob normal lock&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Alice Liquidity token cell    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            142</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            sudt_amount: M*L/X</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;LP type&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;Alice normal lock&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Alice change cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            142</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            sudt_amount: n </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;sudtA_type&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;Alice normal lock&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In this transaction, four types of script will be run to verify the tx:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="info-type-script---rule-5rule6rule7"></a>Info type script - rule 5/rule6/rule7<a class="hash-link" href="#info-type-script---rule-5rule6rule7" title="Direct link to heading">#</a></h3><p>Rule 5 - If this is a matching liquidity transaction, the cell sequence in this tx should follow the rules blow:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-text codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">info_in_cell                            info_out_cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pool_in_cell                            pool_out_cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          -------&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">aggregator_in_cell                      aggregator_out_cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[remove_liquidity_request_cell]         [sudt_cell]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[add_liquidity_request_cell]            [liquidity_cell + change_cell(sudt_cell or ckb_cell)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Rules 6 - If this is initially adding liquidity, verify if minting the correct amount Liquidity token for user, and verify if the data storaged in info cell and pool cell is correct.</p><p>Rule 7 - If this is not initially adding liquidity, iterate through all request cell</p><ul><li>If it is add liquidity request cell, verify if minting the correct amount Liquidity token for user, and add up the CKB amount, sUDT amount and Liquidity token amount for verifying info cell and pool cell later.</li><li>If it is remove liquidity request cell, verify if withdraw the correct CKB amount and sudt amount for user, and add up the CKB amount, sUDT amount and Liquidity token amount for verifying info cell and pool cell later.</li><li>Verify if the data storaged in info cell and pool cell is correct</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="info-lock-script---rule-1"></a>Info lock script - rule 1<a class="hash-link" href="#info-lock-script---rule-1" title="Direct link to heading">#</a></h3><p>Rules 1 - Verify if lock.args is consistent with info type</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="liquidity-request-lock-script---rule-1"></a>Liquidity request lock script - rule 1<a class="hash-link" href="#liquidity-request-lock-script---rule-1" title="Direct link to heading">#</a></h3><p>Rule 1 - verifity input index[1] is info cell</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="sudt-type-script"></a>sUDT type script<a class="hash-link" href="#sudt-type-script" title="Direct link to heading">#</a></h3><p><a href="https://talk.nervos.org/t/rfc-simple-udt-draft-spec/4333" target="_blank" rel="noopener noreferrer">sUDT proposal</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="5-lps-can-cancel-their-own-liquidity-request"></a>5. LPs can cancel their own liquidity request<a class="hash-link" href="#5-lps-can-cancel-their-own-liquidity-request" title="Direct link to heading">#</a></h2><p>Normally your will add liquidity or remove liquidity successfully soon after you submit the liquidity request, but if the price fluctuates above the slippage, your request will be pending until the pool price fluctuates back to the price you submitted.</p><p>So we provide the cancel option for LPs. LPs can send a transaction to cancel their own liquidity request.</p><p>For example, if Bob want to cancel his remove liqidity request:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Input</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Bob remove liquidity request cell    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            235</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Liquidity token amount: L</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;Liquidity token type&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            code: LIQUIDITY_REQ_LOCK_CODE_HASH </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            args: user_lock_hash | version | sudtMin | ckbMin | info_type_hash_32 | 0 | 0 | // tip and tip fee are 0 in current version</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Bob normal cell (used to pay the tx fee)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Bob normal cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        capacity</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;235&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Liquidity token amount: N</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;Liquidity token type&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lock</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;user&#x27;s lock&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This transaction leads to another rule of LIQUIDITY_REQ_LOCK</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="liquidity-request-lock-script---rule-2"></a>Liquidity request lock script - rule 2<a class="hash-link" href="#liquidity-request-lock-script---rule-2" title="Direct link to heading">#</a></h3><p>Rule 2 - If one of input cell in the transaction use user&#x27;s lock specified in liquidity request cell args and the corresponding witness is not 0, unlock the request cell directly.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/tx-script/pool-tx.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/gliaswap-docs/docs/tx-script/swap-tx"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Swap Transaction Structure</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/gliaswap-docs/docs/tx-script/info-type-script"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Info Cell Type Script Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-creat-a-pool" class="table-of-contents__link">1. Creat a pool</a><ul><li><a href="#info-type-script---rule-4" class="table-of-contents__link">Info type script - rule 4</a></li></ul></li><li><a href="#2-lps-submit-add-liquidity-request" class="table-of-contents__link">2. LPs submit add liquidity request</a></li><li><a href="#3-lps-submit-remove-liquidity-request" class="table-of-contents__link">3. LPs submit remove liquidity request</a></li><li><a href="#4-aggregators-match-liquidity-request-with-pool" class="table-of-contents__link">4. Aggregators match liquidity request with pool</a><ul><li><a href="#info-type-script---rule-5rule6rule7" class="table-of-contents__link">Info type script - rule 5/rule6/rule7</a></li><li><a href="#info-lock-script---rule-1" class="table-of-contents__link">Info lock script - rule 1</a></li><li><a href="#liquidity-request-lock-script---rule-1" class="table-of-contents__link">Liquidity request lock script - rule 1</a></li><li><a href="#sudt-type-script" class="table-of-contents__link">sUDT type script</a></li></ul></li><li><a href="#5-lps-can-cancel-their-own-liquidity-request" class="table-of-contents__link">5. LPs can cancel their own liquidity request</a><ul><li><a href="#liquidity-request-lock-script---rule-2" class="table-of-contents__link">Liquidity request lock script - rule 2</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 GliaTeam.</div></div></div></footer></div>
<script src="/gliaswap-docs/styles.e14deca6.js"></script>
<script src="/gliaswap-docs/runtime~main.67eb29e5.js"></script>
<script src="/gliaswap-docs/main.0343998c.js"></script>
<script src="/gliaswap-docs/1.dba57845.js"></script>
<script src="/gliaswap-docs/2.aeef72c1.js"></script>
<script src="/gliaswap-docs/46.04a79037.js"></script>
<script src="/gliaswap-docs/47.2bc9e338.js"></script>
<script src="/gliaswap-docs/935f2afb.4513c572.js"></script>
<script src="/gliaswap-docs/17896441.3c886368.js"></script>
<script src="/gliaswap-docs/121de096.a822be93.js"></script>
</body>
</html>